{%extends 'base.html'%}
{%load static%}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/lesson-list.css' %}">
{% endblock extra_css %}

{% block content %}

<a href="{% url 'lesson:lesson-create' %}">
  <button class="btn btn-sm btn-success">Dodaj lekcje</button>
</a>


<p>LEKCJE</p>
<div class="container-fluid">
  <div class="row">
    <div class="schedule-container col mx-2 pt-2 px-0 border rounded">
      <div class="hours-container pb-2">
        <div class="INSTR">{{current_date|date:"d-m-Y"}}</div>
        {%for i in hours %}
          <div class="hour-tile bold-text H{{i}} {%if i == current_time%}current-hour{%endif%}" style="grid-column-end: span 4">{{i}}<small><sup class="bold-text">00</sup></small></div>
        {%endfor%}
      </div>
    
      {%for instr in instructors_with_lessons %}
      
      <div class="lessons-container pt-1 pb-1">
        <div class="INSTR">
          {{instr}}  
        </div>
        {% comment %} LESSON TILE {% endcomment %}
        {%for lesson in instr.lessons.all%}
          <div class="align-self-center lesson-tile 
                    {{lesson.get_start_time_class}} 
                    {% if lesson.in_progress %} lesson-in-progress{%endif%}"
                    style="grid-column-end: span {{lesson.get_column_span}}">
            
            <div class="row m-0 justify-content-between">
              
              <div class="col-auto px-1
                          {% if lesson.status == '1'%} lesson-confirmed-corner-highlight {%endif%}">
                {{lesson.start_time|time:'H:i'}}
                {% if lesson.status == '0'%}
                  <span class="ml-1"><i class="fas fa-question fa-sm text-danger"></i></span> 
                {%elif lesson.status == '1'%}
                  <span class="ml-1"><i class="fas fa-check text-success"></i></span>
                {%endif%}

              </div>

              {% comment %} LESSON SETTINGS (icon + hidden menu) {% endcomment %}
              <div class="col-auto px-1 lesson-settings-col">
                <i class="fa fa-cog lesson-settings-icon"></i>

                <div class="settings-menu" id="settings_menu_{{lesson.id}}" hidden="true">
                  <div class="lesson-edit-menu-item lesson-settings-menu-item">
                    <a class="lesson-edit-link" href="{% url 'lesson:lesson-edit' lesson.id %}">
                      <i class="no-decoration fa fa-edit fa-sm"></i>
                      <span class="no-decoration">Edytuj</span>
                    </a>
                                      
                  </div>

                  <hr>

                  {% if lesson.status == '0' %}
                    <div class="lesson-in-progress-menu-item lesson-settings-menu-item">
                      <form method="post" action="{% url 'lesson:lesson-confirm' lesson.id %}">
                        {%csrf_token%}
                        <button class="btn_rmv_stl" type="submit">
                          <i class="fa fa-check text-success"></i>
                          <span>Potwierdź</span>
                        </button>
                      </form>
                    </div>
                    <hr>
                  {% elif lesson.status == '1' and not lesson.in_progress %}
                    <div class="lesson-in-progress-menu-item lesson-settings-menu-item">
                      <form method="post" action="{% url 'lesson:lesson-confirm' lesson.id %}">
                        {%csrf_token%}
                        <button class="btn_rmv_stl" type="submit">
                          <i class="fas fa-question text-danger"></i>
                          <span>Niepotwierdzona</span>
                        </button>
                      </form>
                    </div>
                    <hr>
                  {%endif%}

                  
                  
                  {% if not lesson.in_progress %}
                    <div class="lesson-in-progress-menu-item lesson-settings-menu-item">
                      <form method="post" action="{% url 'lesson:lesson-set-in-progress' lesson.id %}">
                        {%csrf_token%}
                        <button class="btn_rmv_stl" type="submit">
                          <i class="fa fa-play fa-sm text-success"></i>
                          <span>Start</span>
                        </button>
                      </form>
                    </div>
                    <!-- <hr> -->
                  {%elif lesson.in_progress%}
                    <div class="lesson-settings-menu-item">
                      <form method="post" action="{% url 'lesson:lesson-set-in-progress' lesson.id %}">
                        {%csrf_token%}
                        <button class="btn_rmv_stl" type="submit">
                          <i class="fas fa-pause fs-sm"></i>
                          <span>Stop</span>
                        </button>
                      </form>
                    </div>
                    <!-- <hr> -->
                    {%endif%}
                  
                </div>
              </div>

            </div>
            
            <div class="row m-0">
              <div class="col-auto px-1">
                <small>
                  <b>K:</b> {{lesson.kite_brand|default_if_none:"<span class='none-equipment'>?</span>"}}
                </small>
              </div>
                
              <div class="col-auto px-1">
                <small>
                  <b>D:</b> {{lesson.board|default_if_none:"<span class='none-equipment'>?</span>"}}
                </small>
              </div>              
            </div>
            
            {%for student in lesson.student.all%}
            <div class="row m-0">
              <div class="col-auto px-1">
                <b>{{student}}</b>
              </div>  
            </div>
            {%endfor%}
            
            {% comment %} <form method="POST" action="{% url 'lesson:lesson-delete' lesson.id %}">
            {% csrf_token %}<input class="btn btn-sm btn-danger" type="submit" value="Usuń">
            </form> {% endcomment %}
          </div>
        {%endfor%}
      </div>
      
      
      {%endfor%}
    </div>
  </div>
</div>

<script src="{% static 'js/lesson_settings.js' %}"></script>

{% endblock content %}
  